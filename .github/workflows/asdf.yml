# Generated by cue/workflows_tool.cue; do not edit
name: Update asdf tool versions
"on":
  workflow_dispatch:
    inputs:
      plugin:
        type: string
        required: true
        description: Which asdf plugin
      constraint:
        type: string
        default: ""
        required: false
        description: Version constraint
jobs:
  compile_assets:
    name: Update ${{ inputs.plugin }}
    permissions:
      contents: write
      pull-requests: write
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b
      - name: Setup asdf
        uses: asdf-vm/actions/install@707e84f3ee349548310aeabdad0dd3bfcb9b69fa
      - id: newestVersion
        name: Get Newest Version
        run: |
          LATEST_VERSION=$(asdf latest '${{ inputs.plugin }}' '${{ inputs.constraint }}')
          echo 'Latest (${{ inputs.constraint }}): $LATEST_VERSION'
          echo ::set-output name=LATEST_VERSION::${LATEST_VERSION}
      - name: Try Installing new version
        run: |
          asdf install '${{ inputs.plugin }}' '${{ steps.newestVersion.outputs.LATEST_VERSION }}'
      - name: Apply latest version to .tool-versions
        run: |
          asdf local '${{ inputs.plugin }}' '${{ steps.newestVersion.outputs.LATEST_VERSION }}'
      - name: Create pull request
        uses: peter-evans/create-pull-request@671dc9c9e0c2d73f07fa45a3eb0220e1622f0c5f
        with:
          add-paths: .tool-versions
          commit-message: Update ${{ inputs.plugin }} to ${{ steps.newestVersion.outputs.LATEST_VERSION }}
          title: Update ${{ inputs.plugin }} to ${{ steps.newestVersion.outputs.LATEST_VERSION }}
          branch: asdf/${{ inputs.plugin }}/${{ steps.newestVersion.outputs.LATEST_VERSION }}
          delete-branch: true
          labels: asdf,enhancement
